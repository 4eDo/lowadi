// ==UserScript==
// @name         Кач-прогон
// @version      1.1
// @description  ПРИ ВЫПОЛНЕНИИ НЕ ЗАХОДИТЕ К ДРУГИМ ЛОШАДЯМ!
// @namespace    http://tampermonkey.net/
// @author       4eDo (https://github.com/4eDo/lowadi)
// @match        https://www.lowadi.com/elevage/chevaux/*
// ==/UserScript==
var doLesson,doCarrot,doKSK,lenKSK,typeKSK,ages;$("body#global").append('<div class="stopMe" style="display:block;color:#ffffff;position:fixed;width: 100px;height: 20px;top: 30px;padding: 5px;left: 10px;background-color:rgba(128, 0, 0, 0.9);z-index:990;border-radius: 4px;"><center><button id="noGrind" type="button"> ОСТАНОВИТЬ </button></center></div>'),$("#noGrind").click(function(){document.title="П Р Е К Р А Щ А Ю",stopAll(),location.reload(),alert("Выращивание лошади прервано.")}),1==localStorage.getItem("isOptGrind")?(doCarrot=doLesson=1,doKSK=2,lenKSK=0,typeKSK=localStorage.getItem("inpKskType"),ages="f"==typeKSK?[34,44,58,68,84,118]:[52,62,76,86,102,120]):(document.title="З А В Е Р Ш Е Н О",$("body#global").append('<div class="grindPanel" style="display:block;color:#ffffff;position:fixed;width: 400px;height: 200px;top: 50%;margin-top: -100px;margin-left: -200px;padding: 20px;left: 50%;background-color:rgba(0, 0, 0, 0.9);z-index:990;border-radius: 4px;"></div>'),$(".grindPanel").append('<center><p style="z-index:999;color:#ffffff; font-size: 13px; font-family: Arial,Helvetica,sans-serif;text-shadow: 1px 1px 2px #778899;margin-top:5px;"><b>Настройки</b></p></center></br>'),$(".grindPanel").append('<p>Кач или прогон: <select id="inpActType" style=" "><option value="1">\tКач одной лошади\t</option><option value="0">\tПрогон табуна\t\t</option></select></p>'),$(".grindPanel").append('<p>Тип КСК: <select id="inpKskType" style=" "><option value="f">\tЛес\t</option><option value="m">\tГоры</option></select></p>'),$(".grindPanel").append('</br><center><button id="submGrind" type="button"> Применить и запустить </button></center>')),null!==localStorage.getItem("isOptGrind")&&($("#inpKskType").val(localStorage.getItem("inpKskType")),$("#inpActType").val(localStorage.getItem("inpActType"))),$("#submGrind").click(function(){localStorage.setItem("inpKskType",$("#inpKskType option:selected").val()),localStorage.setItem("inpActType",$("#inpActType option:selected").val()),localStorage.setItem("firstChevalId",chevalId),localStorage.setItem("itIsFirstHorse","true"),localStorage.setItem("isOptGrind",1),alert("Настройки применены. Нажмите 'Ок', чтобы запустить скрипт.\n\n Покиньте вкладку до завершения работы скрипта (он смущается и работает медленнее). Не заходите к другим лошадям. \n\n После завершения надпись на вкладке изменится на 'Завершено'."),location.reload()}),localStorage.setItem("stopGrind",0);var growButton=0;function pause(e){return Math.floor(81*Math.random())+120+e}function stopAll(){clearTimeout(mainSet),clearTimeout(checkSet),localStorage.setItem("stopGrind",0),localStorage.setItem("isOptGrind",0),localStorage.removeItem("itIsFirstHorse"),localStorage.removeItem("firstChevalId")}function checkKSK(){0!=doKSK&&$("#form-extends-money").length<1&&5<chevalAge&&(2==doKSK&&getMerch("Одеяло Гипноса")||(0==localStorage.getItem("inpActType")?nextHorse():(document.title="ЗАПИШИ МЕНЯ В КСК",stopAll(),location.reload(),alert("ЗАПИШИ МЕНЯ В КСК"))))}function getMerch(e){var t=0,n=$("#objects-body-content a");if(0!==n.length)for(var a=0;a<n.length;a++)-1!==$("#objects-body-content a").eq(a).attr("data-tooltip").indexOf(e)&&(t=1);return 0!=t}function feed(e=0){if(document.title="Корм",4<chevalAge){var t=$(".float-right.section-fourrage.section-fourrage-quantity").text().trim().split(" / "),n=+t[1],a=+t[0];if(-1!==$("#care-tab-feed #messageBoxInline").text().indexOf("недостаточный")&&(n=20-a),$("#haySlider li:eq("+(n-a)+")").click(),16<chevalAge){var i=+(t=$(".float-right.section-avoine.section-avoine-quantity").text().trim().split(" / "))[1];switch(e){case"training":i=n-2;break;case"competition":i=8}t=+t[0];$("#oatsSlider li:eq("+(i-t)+")").click()}setTimeout(function(){$("#feed-button").click()},pause(0))}else $("#boutonAllaiter").click()}function grow(){0==growButton&&(document.title="ОР",$("#night-tab-age button").click(),growButton=1)}function nextHorse(){console.log("next"),goToLink($("#nav-next").attr("href"),1)}function needFeed(){var e=$(".float-right.section-fourrage.section-fourrage-quantity").text().trim().split(" / "),t=+e[1],n=+e[0],a=$(".float-right.section-avoine.section-avoine-quantity").text().trim().split(" / "),e=+a[1],a=+a[0];return chevalAge<6&&1==doMilk?!$("#boutonAllaiter").hasClass("action-disabled"):17<chevalAge?!(t<=n&&e<=a||-1!==$("#care-tab-feed #messageBoxInline").text().indexOf("толст")):!(chevalAge<6)&&!(t<=n||-1!==$("#care-tab-feed #messageBoxInline").text().indexOf("толст"))}function needLesson(){return 1==doLesson&&(23<chevalAge&&20<+$("#energie").text()-+$("#mission-wrapper").html().substr($("#mission-wrapper").html().indexOf("Энергия"),45).replace(/[^,0-9]/gim,"").replace(/[,]/gim,".")&&(-1===$("#mission").text().indexOf("недостаточно энергии")&&!$("#mission-wrapper a").hasClass("action-disabled")))}function needSleep(){return isDisabled("boutonCoucher")}function needMilk(){return isDisabled("boutonAllaiter")}function needDrink(){return isDisabled("boutonBoire")}function needCarrot(){return isDisabled("boutonCarotte")&&1==doCarrot}function needCare(){return isDisabled("boutonCaresser")}function needShortGame(){return 90<chevalEnergie&&!needDrink()}function needLongGame(){return chevalEnergie<90&&70<chevalEnergie&&needCare()}function needWash(){return isDisabled("boutonPanser")}function needShortTrain(){return 90<chevalEnergie&&needDrink()}function needLongTrain(){return 20<chevalEnergie&&!needDrink()&&needCare()}function isDisabled(e){return!$("#"+e).hasClass("action-disabled")}function milk(){$("#boutonAllaiter").click(),document.title="Молоко"}function wash(){$("#boutonPanser").click(),document.title="Чистка"}function sleep(){$("#boutonCoucher").click(),document.title="Сон"}function drink(){$("#boutonBoire").click(),document.title="Вода"}function care(){$("#boutonCaresser").click(),document.title="Ласка"}function carrot(){$("#boutonCarotte").click(),document.title="Морковь"}function lesson(){$("#mission-wrapper a").click(),document.title="Урок"}function nextAct(){(0==localStorage.getItem("inpActType")?nextHorse:grow)()}function game(e){document.title="Игра",goSlidebar(e,"centerPlaySlider","formCenterPlaySubmit")}function walk(e,t){switch(document.title="Прогулка",t){case"Лес":goSlidebar(e,"walkforetSlider","walk-foret-submit");break;case"Горы":goSlidebar(e,"walkmontagneSlider","walk-montagne-submit");break;case"Пляж":goSlidebar(e,"walkplageSlider","walk-plage-submit")}}async function training(e,t){switch(document.title="Тренировка",t){case"Выносливость":goSlidebar(e,"trainingEnduranceSlider","training-endurance-submit");break;case"Скорость":goSlidebar(e,"trainingVitesseSlider","training-vitesse-submit");break;case"Выездка":goSlidebar(e,"trainingDressageSlider","training-dressage-submit");break;case"Галоп":goSlidebar(e,"trainingGalopSlider","training-galop-submit");break;case"Рысь":goSlidebar(e,"trainingTrotSlider","training-trot-submit");break;case"Прыжки":goSlidebar(e,"trainingSautSlider","training-saut-submit")}}function goSlidebar(e,t,n){setSlidebar(e,t)&&$("#"+n).click()}function setSlidebar(e,t){let n;switch(e){case"2h":n=4;break;case"max":n=0<$("#"+t+" li.disabled").length?$("#"+t+" li.disabled").first().attr("data-number")-1:20;break;case"m-1":n=0<$("#"+t+" li.disabled").length?$("#"+t+" li.disabled").first().attr("data-number")-3:18}return $("#"+t+" li:eq("+n+")").click(),!0}async function progon(){-1!==location.href.indexOf("/elevage/chevaux/centreInscription?id=")?setKSK():-1!==location.href.indexOf("chevaux/cheval?id")&&"0"!==localStorage.getItem("isOptGrind")?(checkKSK(),chevalAge<6?(needMilk()?milk:needWash()?wash:needSleep()?sleep:nextAct)():chevalAge<8?(needFeed()?feed:needWash()?wash:needSleep()?sleep:nextAct)():chevalAge<18?needWash()?wash():needShortGame()?game("2h"):needDrink()?drink():needFeed()?feed():needLongGame()?game(1==doCarrot?"max":"m-1"):(needCare()?care:needCarrot()?carrot:needSleep()?sleep:nextAct)():chevalAge<24?needWash()?wash():needShortTrain()?walk("2h","Лес"):needDrink()?drink():needFeed()&&needLongTrain()?feed("training"):needLongTrain()?walk(1==doCarrot?"max":"m-1","Лес"):(needCare()?care:needCarrot()?carrot:needSleep()?sleep:nextAct)():chevalAge<ages[0]?needWash()?wash():needShortTrain()?lesson():needDrink()?drink():needFeed()&&needLongTrain()?feed("training"):needLongTrain()?walk("max","Лес"):(needCare()?care:needCarrot()?carrot:needSleep()?sleep:nextAct)():chevalAge<ages[1]?needWash()?wash():needShortTrain()?lesson():needDrink()?drink():needFeed()&&needLongTrain()?feed("training"):needLongTrain()?training("max","Выездка"):(needCare()?care:needCarrot()?carrot:needSleep()?sleep:nextAct)():chevalAge<ages[2]?needWash()?wash():needShortTrain()?lesson():needDrink()?drink():needFeed()&&needLongTrain()?feed("training"):needLongTrain()?training("max","Прыжки"):(needCare()?care:needCarrot()?carrot:needSleep()?sleep:nextAct)():chevalAge>ages[2]-1&&chevalAge<ages[3]?0==localStorage.getItem("inpActType")?nextHorse():(document.title="ЗАПИШИ МЕНЯ НА КРОСС",stopAll(),location.reload(),alert("Я не умею записывать на соревнования!\n Запиши лошадь сам!\n НЕ дольше нужного, только до зажирнения!")):chevalAge<ages[4]?needWash()?wash():needShortTrain()?lesson():needDrink()?drink():needFeed()&&needLongTrain()?feed("training"):needLongTrain()?training("max","Выносливость"):(needCare()?care:needCarrot()?carrot:needSleep()?sleep:nextAct)():chevalAge<ages[5]?needWash()?wash():needShortTrain()?lesson():needDrink()?drink():needFeed()&&needLongTrain()?feed("training"):needLongTrain()?walk("max","Горы"):(needCare()?care:needCarrot()?carrot:needSleep()?sleep:nextAct)():"0"==localStorage.getItem("inpActType")?localStorage.getItem("firstChevalId")==chevalId&&"false"==localStorage.getItem("itIsFirstHorse")?(alert("Прогон окончен!"),stopAll()):(localStorage.setItem("itIsFirstHorse","false"),nextHorse()):(alert("Возраст максимален!"),stopAll())):-1!==location.href.indexOf("/elevage/chevaux/?elevage=")&&(history.go(-1),pause(6e5))}var checkSet=setTimeout(function e(){growButton=0,setTimeout(e,pause(8e3))},pause(8e3)),mainSet=setTimeout(function e(){0==localStorage.getItem("stopGrind")&&progon(),setTimeout(e,pause(100))},pause(100));
