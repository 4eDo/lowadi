// ==UserScript==
// @name         Соревнования
// @version      3.0
// @description  Запись на соревнования. ПРИ ВЫПОЛНЕНИИ НЕ СИДИТЕ НА СТРАНИЦЕ, ОТ ЭТОГО СКРИПТ ТОРМОЗИТ! И НЕ ЗАХОДИТЕ К ДРУГИМ ЛОШАДЯМ!
// @namespace    http://tampermonkey.net/
// @author       4eDo
// @match        https://www.lowadi.com/elevage/chevaux/*
// @match        https://www.lowadi.com/elevage/competition/*
// ==/UserScript==
if($("body#global").append("<div class=\"stopMe\" style=\"display:block;color:#ffffff;position:fixed;width: 100px;height: 20px;top: 30px;padding: 5px;left: 10px;background-color:rgba(128, 0, 0, 0.9);z-index:990;border-radius: 4px;\"><center><button id=\"noCup\" type=\"button\"> \u041E\u0421\u0422\u0410\u041D\u041E\u0412\u0418\u0422\u042C </button></center></div>"),$("#noCup").click(function(){localStorage.setItem("stopCup",0),localStorage.setItem("isOpt",0),document.title="\u041F \u0420 \u0415 \u041A \u0420 \u0410 \u0429 \u0410 \u042E",localStorage.setItem("errLog","\u0417\u0430\u043F\u0438\u0441\u044C \u043D\u0430 \u0441\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u044F \u043F\u0440\u0438\u043D\u0443\u0434\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u043E\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u0430"),location.reload(),alert("\u0417\u0430\u043F\u0438\u0441\u044C \u043D\u0430 \u0441\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u044F \u043F\u0440\u0435\u0440\u0432\u0430\u043D\u0430.")}),1==localStorage.getItem("isOpt")){var sorev=localStorage.getItem("inpSorev"),selYY=localStorage.getItem("inpYY"),selMM=localStorage.getItem("inpMM"),doLesson=localStorage.getItem("inpLesson"),difficulty=0,doMash=localStorage.getItem("inpMash"),compAll=localStorage.getItem("inpType"),maxAge=0,hrsEnrg=0;maxAge=parseInt(parseInt(localStorage.getItem("startAge"))+parseInt(12*selYY)+parseInt(selMM))}else document.title="\u0417 \u0410 \u0412 \u0415 \u0420 \u0428 \u0415 \u041D \u041E",$("body#global").append("<div class=\"cupPanel\" style=\"display:block;color:#ffffff;position:fixed;width: 400px;height: 200px;top: 50%;margin-top: -100px;margin-left: -200px;padding: 20px;left: 50%;background-color:rgba(0, 0, 0, 0.9);z-index:990;border-radius: 4px;\"></div>"),$(".cupPanel").append("<center><p style=\"z-index:999;color:#ffffff; font-size: 13px; font-family: Arial,Helvetica,sans-serif;text-shadow: 1px 1px 2px #778899;margin-top:5px;\"><b>\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438</b></p><div id=\"ErrMsg\" style=\"color:#ff8080;\"></div></center></br>"),$(".cupPanel").append("<p>\u0421\u043A\u043E\u043B\u044C\u043A\u043E \u0437\u0430\u043F\u0438\u0441\u044B\u0432\u0430\u0442\u044C: <input id=\"inpYY\" type=\"number\" min=\"0\" value=\"0\">\u043B\u0435\u0442  <input id=\"inpMM\" type=\"number\" min=\"0\" value=\"0\">\u043C\u0435\u0441. </p>"),$(".cupPanel").append("<p>\u0421\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u0435: <select id=\"inpSorev\" style=\" \"><option value=\"\u0420\u044B\u0441\u044C\">\t\u0420\u044B\u0441\u044C\t\t\t\t</option><option value=\"\u0413\u0430\u043B\u043E\u043F\">\t\u0413\u0430\u043B\u043E\u043F\t\t\t\t</option><option value=\"\u0412\u044B\u0435\u0437\u0434\u043A\u0430\">\t\u0412\u044B\u0435\u0437\u0434\u043A\u0430\t\t\t\t</option><option value=\"\u041A\u0440\u043E\u0441\u0441\">\t\u041A\u0440\u043E\u0441\u0441\t\t\t\t</option><option value=\"\u041A\u043E\u043D\u043A\u0443\u0440\">\t\u041A\u043E\u043D\u043A\u0443\u0440\t\t\t\t</option><option value=\"\u0413\u043E\u043D\u043A\u0438 \u0432\u043E\u043A\u0440\u0443\u0433 \u0431\u043E\u0447\u0435\u043A\">\t\u0413\u043E\u043D\u043A\u0438 \u0432\u043E\u043A\u0440\u0443\u0433 \u0431\u043E\u0447\u0435\u043A\t</option><option value=\"\u041A\u0430\u0442\u0442\u0438\u043D\u0433\">\t\u041A\u0430\u0442\u0442\u0438\u043D\u0433\t\t\t\t</option><option value=\"\u0422\u0440\u0435\u0439\u043B\">\t\u0422\u0440\u0435\u0439\u043B\t\t\t\t</option><option value=\"\u0420\u0435\u0439\u043D\u0438\u043D\u0433\">\t\u0420\u0435\u0439\u043D\u0438\u043D\u0433\t\t\t\t</option><option value=\"\u0412\u0435\u0441\u0442\u0435\u0440\u043D \u043F\u043B\u0435\u0436\u0435\">\t\u0412\u0435\u0441\u0442\u0435\u0440\u043D \u043F\u043B\u0435\u0436\u0435\t\t</option></select></p>"),$(".cupPanel").append("<p>\u0421\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u044F: <select id=\"inpType\" style=\" \"><option value=\"1\">\t\u0412\u0441\u0435\t</option><option value=\"0\">\t\u0422\u043E\u043B\u044C\u043A\u043E \u043F\u043E\u0440\u043E\u0434\u043D\u044B\u0435\t</option></select></p>"),$(".cupPanel").append("<p>\u0423\u0440\u043E\u043A: <select id=\"inpLesson\" style=\" \"><option value=\"1\">\t\u0412\u043A\u043B\u044E\u0447\u0451\u043D\t\t</option><option value=\"0\">\t\u0412\u044B\u043A\u043B\u044E\u0447\u0435\u043D\t</option></select></p>"),$(".cupPanel").append("<p>\u0421\u043C\u0435\u0441\u044C: <select id=\"inpMash\" style=\" \"><option value=\"0\">\t\u041D\u0435 \u0434\u0430\u0432\u0430\u0442\u044C\t\t</option><option value=\"1\">\t\u0414\u0430\u0432\u0430\u0442\u044C\t</option></select></p>"),$(".cupPanel").append("</br><center><button id=\"submCup\" type=\"button\"> \u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C \u0438 \u0437\u0430\u043F\u0443\u0441\u0442\u0438\u0442\u044C </button></center>");null===localStorage.getItem("isOpt")?($("#inpYY").val(0),$("#inpMM").val(1),$("#inpMinDiff").val(0)):(null!==localStorage.getItem("errLog")&&$("#ErrMsg").text(localStorage.getItem("errLog")),$("#inpYY").val(localStorage.getItem("inpYY")),$("#inpMM").val(localStorage.getItem("inpMM")),$("#inpMash").val(localStorage.getItem("inpMash")),$("#inpSorev").val(localStorage.getItem("inpSorev")),$("#inpType").val(localStorage.getItem("inpType")),$("#inpLesson").val(localStorage.getItem("inpLesson"))),$("#submCup").click(function(){localStorage.setItem("inpYY",$("#inpYY").val()),localStorage.setItem("inpMM",$("#inpMM").val()),localStorage.setItem("inpSorev",$("#inpSorev option:selected").val()),localStorage.setItem("inpType",$("#inpType option:selected").val()),localStorage.setItem("inpLesson",$("#inpLesson option:selected").val()),localStorage.setItem("inpMash",$("#inpMash option:selected").val()),localStorage.setItem("cupCount",0),localStorage.setItem("isOpt",1),localStorage.removeItem("errLog"),-1!==location.href.indexOf("chevaux/cheval?id")&&localStorage.setItem("startAge",chevalAge),alert("\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D\u044B. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 '\u041E\u043A', \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043F\u0443\u0441\u0442\u0438\u0442\u044C \u0441\u043A\u0440\u0438\u043F\u0442.\n\n \u041F\u043E\u043A\u0438\u043D\u044C\u0442\u0435 \u0432\u043A\u043B\u0430\u0434\u043A\u0443 \u0434\u043E \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044F \u0440\u0430\u0431\u043E\u0442\u044B \u0441\u043A\u0440\u0438\u043F\u0442\u0430 (\u043E\u043D \u0441\u043C\u0443\u0449\u0430\u0435\u0442\u0441\u044F \u0438 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 \u043C\u0435\u0434\u043B\u0435\u043D\u043D\u0435\u0435). \n\n \u041F\u043E\u0441\u043B\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044F \u043D\u0430\u0434\u043F\u0438\u0441\u044C \u043D\u0430 \u0432\u043A\u043B\u0430\u0434\u043A\u0435 \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u0441\u044F \u043D\u0430 '\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043E'."),location.reload()}),localStorage.setItem("stopCup",0);var tSleep,tEat,tRun,growButton=0,energy=20;function pause(a){return Math.floor(Math.random()*251)+150+a}function getTime(){var a=$(".hour").text(),b=+(a[0]+a[1]),c=+(a[3]+a[4]);return 60*b+c}function clearNulls(){growButton=0}function getMerch(b){var c=0,d=$("#objects-body-content a");if(0!==d.length)for(var e=0;e<d.length;e++)-1!==$("#objects-body-content a").eq(e).attr("data-tooltip").indexOf(b)&&(c=1);return 0!=c}function lesson(){$("#mission-wrapper a").click()}function drink(){$("#boutonBoire").click()}function carrot(){$("#boutonCarotte").click()}function care(){$("#boutonCaresser").click()}function wash(){$("#boutonPanser").click()}function milk(){$("#boutonAllaiter").click()}function mash(){$("#boutonMash").click()}function feed(){if(4<chevalAge){var a=$(".float-right.section-fourrage.section-fourrage-quantity").text().trim().split(" / "),b=+a[1],c=+a[0];if(-1!==$("#care-tab-feed #messageBoxInline").text().indexOf("\u043D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u044B\u0439")&&(b=20-c),$("#haySlider li:eq("+(b-c)+")").click(),16<chevalAge){var d=$(".float-right.section-avoine.section-avoine-quantity").text().trim().split(" / "),e=+d[1],f=+d[0];$("#oatsSlider li:eq("+(e-f)+")").click()}setTimeout(function(){$("#feed-button").click()},200)}else milk()}function sleep(){$("#boutonCoucher").click()}function grow(){0==growButton&&($("#night-wrapper button:contains(\"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C\")").click(),growButton=1)}function galop(){$("a:contains(\""+sorev+"\")")[0].click()}function needWash(){return!$("#boutonPanser").hasClass("action-disabled")}function needDrink(){return!($("#boutonBoire").hasClass("action-disabled")||getMerch("\u041B\u0430\u0441\u043A\u0430 \u0424\u0438\u043B\u043E\u0442\u0435\u0441"))}function needCarrot(){return!($("#boutonCarotte").hasClass("action-disabled")||getMerch("\u041B\u0430\u0441\u043A\u0430 \u0424\u0438\u043B\u043E\u0442\u0435\u0441"))}function needCare(){return!$("#boutonCaresser").hasClass("action-disabled")}function needFeed(){var a=$(".float-right.section-fourrage.section-fourrage-quantity").text().trim().split(" / "),b=+a[1],c=+a[0],d=$(".float-right.section-avoine.section-avoine-quantity").text().trim().split(" / "),e=+d[1],f=+d[0];return 6>chevalAge&&1==doMilk?!$("#boutonAllaiter").hasClass("action-disabled"):17<chevalAge?!(c>=b&&f>=e||-1!==$("#care-tab-feed #messageBoxInline").text().indexOf("\u0442\u043E\u043B\u0441\u0442")):!(6>chevalAge)&&!(c>=b||-1!==$("#care-tab-feed #messageBoxInline").text().indexOf("\u0442\u043E\u043B\u0441\u0442"))}function needLesson(){return!!(23<chevalAge&&20<+$("#energie").text()-+$("#mission-wrapper").html().substr($("#mission-wrapper").html().indexOf("\u042D\u043D\u0435\u0440\u0433\u0438\u044F"),45).replace(/[^,0-9]/gim,"").replace(/[,]/gim,".")&&1==doLesson)&&-1===$("#mission").text().indexOf("\u043D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u044D\u043D\u0435\u0440\u0433\u0438\u0438")&&!$("#mission-wrapper a").hasClass("action-disabled")}function needSleep(){return!$("#boutonCoucher").hasClass("action-disabled")}function needMash(){return!(1!==doMash)&&!($("#boutonMash").hasClass("action-disabled")||23>chevalAge)}function laska(){needCare()?(document.title="\u041B\u0430\u0441\u043A\u0430",care()):needDrink()?(document.title="\u041F\u0438\u0442\u044C",drink()):needCarrot()?(document.title="\u041C\u043E\u0440\u043A\u043E\u0432\u044C",carrot()):needMash()&&(document.title="\u0421\u043C\u0435\u0441\u044C",mash())}function needLaska(){return!!(needCare()||needCarrot()||needDrink()||needMash())}function progon(){if(-1!==location.href.indexOf("chevaux/cheval?id"))document.title="\u041B\u043E\u0448\u0430\u0434\u044C",getMerch("\u0410\u0445\u0438\u043B\u043B\u0435\u0441\u043E\u0432\u0430 \u043F\u044F\u0442\u0430")?(tSleep=1439,tEat=1409,tRun=1319):(tSleep=1319,tEat=1289,tRun=1169),chevalAge<maxAge?getTime()>=tSleep?needSleep()?(document.title="\u0421\u043F\u0430\u0442\u044C",sleep()):(document.title="\u041E\u0440",grow()):needFeed()&&getTime()>=tEat?(document.title="\u041A\u043E\u0440\u043C",feed()):needWash()?(document.title="\u0427\u0438\u0441\u0442\u043A\u0430",wash()):needLesson()?(document.title="\u0423\u0440\u043E\u043A",lesson()):0<+$("#energie").text()-energy&&getTime()<=tRun?(document.title="\u0421\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u044F",hrsEnrg=parseFloat($("#energie").text()),localStorage.setItem("hrsEnrg",hrsEnrg),galop()):needLaska()?laska():needFeed()?(document.title="\u041A\u043E\u0440\u043C",feed()):needSleep()?(document.title="\u0421\u043E\u043D",sleep()):(document.title="\u041E\u0440",grow()):(clearTimeout(mainSet),clearTimeout(checkSet),localStorage.setItem("stopCup",0),localStorage.setItem("isOpt",0),localStorage.setItem("errLog","\u0417\u0430\u043F\u0438\u0441\u044C \u043D\u0430 \u0441\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u044F \u043E\u043A\u043E\u043D\u0447\u0435\u043D\u0430"),document.title="\u0417 \u0410 \u0412 \u0415 \u0420 \u0428 \u0415 \u041D \u041E",location.reload(),alert("\u0417\u0430\u043F\u0438\u0441\u044C \u043D\u0430 \u0441\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u044F \u043E\u043A\u043E\u043D\u0447\u0435\u043D\u0430. \n \u0414\u043B\u044F \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0435\u043D\u0438\u044F \u0440\u0430\u0431\u043E\u0442\u044B \u043D\u0430\u0436\u043C\u0438\u0442\u0435 '\u041E\u043A'"));else if(-1===location.href.indexOf("competition/inscription"))-1!==location.href.indexOf("/elevage/chevaux/?elevage=")&&(history.go(-1),pause(6e5));else if(document.title="\u0417\u0430\u043F\u0438\u0441\u044C...",0!==$("#race").length||0!==$("#public").length){var a=0,b=0,c=0,d=$("#race tr[height=\"40\"] td[class^=\"width-10 align-center\"] .nowrap");if(0!==$("#race").length)for(var e=0;e<d.length;e++)a=+$("#race tr[height=\"40\"]:eq("+e+") td[class^=\"width-10 align-center\"] .nowrap").eq(e).text().replace(/[^.0-9]/gim,""),b=parseFloat($("#race tr[height=\"40\"]:eq("+e+") td[class^=\"width-20 align-center\"] strong").eq(e).text()),hrsEnrg=parseFloat(localStorage.getItem("hrsEnrg")),a>=difficulty&&0<hrsEnrg-b&&(c=parseFloat(localStorage.getItem("hrsEnrg"))-b,localStorage.setItem("hrsEnrg",c),$("#race tr[height=\"40\"]:eq("+e+") td[class^=\"width-10 align-center\"] button").click()),10>hrsEnrg-b&&$("#table-0 a.horsename")[0].click();else if(1==compAll){d=$("#public tr[height=\"40\"] td[class^=\"width-10 align-center\"] .nowrap");for(var f=0;f<d.length;f++)a=+$("#public tr[height=\"40\"]:eq("+f+") td[class^=\"width-10 align-center\"] .nowrap ").eq(f).text().replace(/[^.0-9]/gim,""),b=parseFloat($("#public tr[height=\"40\"]:eq("+f+") td[class^=\"width-20 align-center\"] strong").eq(f).text()),hrsEnrg=parseFloat(localStorage.getItem("hrsEnrg")),a>=difficulty&&0<hrsEnrg-b&&(c=parseFloat(localStorage.getItem("hrsEnrg"))-b,localStorage.setItem("hrsEnrg",c),$("#public tr[height=\"40\"]:eq("+f+") td[class^=\"width-10 align-center\"] button").click()),10>hrsEnrg-b&&$("#table-0 a.horsename")[0].click()}else 1!==compAll&&(document.title="!! \u0421\u041E\u0420\u0415\u0412  \u041D\u0415\u0422 !!",alert("\u0421\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u0439, \u0443\u0434\u043E\u0432\u043B\u0435\u0442\u0432\u043E\u0440\u044F\u044E\u0449\u0438\u0445 \u0437\u0430\u0434\u0430\u043D\u043D\u044B\u043C \u043A\u0440\u0438\u0442\u0435\u0440\u0438\u044F\u043C, \u043D\u0435\u0442. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C \u043F\u043E\u0437\u0436\u0435. \n \u0414\u043B\u044F \u043E\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0438 \u0441\u043A\u0440\u0438\u043F\u0442\u0430 \u043D\u0430\u0436\u043C\u0438\u0442\u0435 '\u041E\u043A'"),clearTimeout(mainSet),clearTimeout(checkSet),localStorage.setItem("stopCup",0),localStorage.setItem("isOpt",0),localStorage.setItem("errLog","\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0445 \u0441\u043E\u0440\u0435\u0432\u043D\u043E\u0432\u0430\u043D\u0438\u0439 \u043D\u0435\u0442"),location.reload())}else-1!==document.body.innerHTML.indexOf("\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0445 \u0441\u043E\u0441\u0442\u044F\u0437\u0430\u043D\u0438\u0439 \u043D\u0435\u0442.")&&0===growButton&&($("#table-0 a.horsename")[0].click(),growButton=1)}if(1==localStorage.getItem("isOpt"))var checkSet=setTimeout(function a(){clearNulls(),setTimeout(a,pause(7850))},pause(7850)),mainSet=setTimeout(function a(){0==localStorage.getItem("stopCup")&&progon(),setTimeout(a,pause(0))},pause(0));
